!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var i={on:function(t,e){this._eventHandlers||(this._eventHandlers={}),this._eventHandlers[t]||(this._eventHandlers[t]=[]),this._eventHandlers[t].push(e)},off:function(t,e){let n=this._eventHandlers&&this._eventHandlers[t];if(n)for(let t=0;t<n.length;t++)n[t]===e&&n.splice(t--,1)},trigger:function(t){if(!this._eventHandlers||!this._eventHandlers[t])return;let e=this._eventHandlers[t];for(let t=0;t<e.length;t++)e[t].apply(this,[].slice.call(arguments,1))}};class r{constructor(t,e,n){this._map=r.createEmptyMap(t,e),this._width=t,this._height=e,this._emptySymbol=n}get width(){return this._width}get height(){return this._height}isEmpty(t,e){return void 0===this._map[t]||void 0===this._map[t][e]||this._map[t][e]===this._emptySymbol}put(t,e,n){this._map[t][e]=n}get(t,e){return void 0===this._map[t]||void 0===this._map[t][e]?this._emptySymbol:this._map[t][e]}getLineByDelta(t){let e=[],n=t.start.y,i=t.start.x;for(let r=0;r<t.count;r++){let r=this.get(n,i);e.push({row:n,col:i,symbol:r}),n+=t.delta.y,i+=t.delta.x}return e}get emptyCells(){let t=[];for(let e=0;e<this._height;e++)for(let n=0;n<this._width;n++)this.isEmpty(e,n)&&t.push({row:e,col:n});return t}static createEmptyMap(t,e,n){const i=[];for(let r=0;r<e;r++){i[r]=[];for(let e=0;e<t;e++)i[r][e]=n}return i}static getDeltas(t,e,n){return[{start:{x:n-t+1,y:e-t+1},delta:{x:1,y:1},count:2*t-1},{start:{x:n,y:e-t+1},delta:{x:0,y:1},count:2*t-1},{start:{x:n-t+1,y:e},delta:{x:1,y:0},count:2*t-1},{start:{x:n-t+1,y:e+t-1},delta:{x:1,y:-1},count:2*t-1}]}static checkLineOnWinner(t,e,n){let i=[];for(let r of t)if(r.symbol===e?i.push(r):i=[],i.length===n)return i;return[]}static weightLine(t,e,n){if(t.length%2!=1)return 0;const i=(t.length+1)/2-1;if(t[i].symbol!==n)return 0;t[i].symbol=e;let r=this.getMaxLineData(t.map(t=>t.symbol),e,n);return t[i].symbol=n,s(r)*r.count*r.count}static getMaxLineData(t,e,n){let i={start:!1,end:!1,count:0},r={start:!1,end:!1,count:0};for(let l=0;l<t.length;l++)t[l]===e?i.count++:(t[l]===n&&(0===i.count?i.start=!0:i.end=t[l]===n),0!==i.count&&(s(r)<s(i)&&(r=i),i={start:!1,end:!1,count:0}));return r}}function s(t){return t.count+(t.start?1:0)+(t.end?1:0)}var l=r;class o{constructor(t,e){this._x=t,this._y=e}get x(){return this._x}get y(){return this._y}add(t){return new o(this._x+t.x,this._y+t.y)}}var u=o;class a{constructor(t){this._gameSettings=t,this._currentDimension=t.dimension,this._isCrossCurrentPlayer=!0,this._field=new l(t.dimension,t.dimension,a.EMPTY),this._lastSteps=[]}static get CROSS(){return"X"}static get ZERO(){return"O"}static get EMPTY(){return" "}get field(){return this._field}get currentPlayer(){return this._isCrossCurrentPlayer?a.CROSS:a.ZERO}get lastSteps(){return this._lastSteps}get status(){return void 0===this._status?null:this._status}get countToWin(){return this._gameSettings.countToWin}getSymbolFromField(t,e){return this._field.get(t,e)}makeStep(t,e,n){if(void 0!==this._status||!this._field.isEmpty(t,e))return;this._field.put(t,e,n),this._lastSteps.push(new u(e,t)),this._isCrossCurrentPlayer=!this._isCrossCurrentPlayer;const i=this.getWinningLine(t,e);0!==i.length&&(this._status={symbol:n,line:i}),this._field.emptyCells.length<this._currentDimension*this._currentDimension/2?(this.enlargeField(1,1),this.trigger("makeStep",t+1,e+1,n)):this.trigger("makeStep",t,e,n)}getWinningLine(t,e){if(this._field.isEmpty(t,e))return[];const n=this._field.get(t,e),i=l.getDeltas(this._gameSettings.countToWin,t,e).map(t=>this._field.getLineByDelta(t)).map(t=>l.checkLineOnWinner(t,n,this._gameSettings.countToWin)).filter(t=>0!==t.length);return void 0!==i[0]?i[0]:[]}enlargeField(t,e){if(t<=0||e<=0)return;const n=this._currentDimension+t+e,i=new l(n,n);for(let e=0;e<this._currentDimension;e++)for(let n=0;n<this._currentDimension;n++)i.put(e+t,n+t,this._field.get(e,n));this._currentDimension=n,this._field=i,this._lastSteps=this._lastSteps.map(e=>e.add(new u(t,t))),this.trigger("enlargeField")}}for(let t in i)a.prototype[t]=i[t];var c=a;const h=document.getElementById("fieldWrapper");function d(t){if(null!==t.status||t.currentPlayer!==c.ZERO)return;let e=function(t){let e=t.field,n=e.emptyCells,i=[];for(let r of n){let n=l.getDeltas(t.countToWin+1,r.row,r.col).map(t=>e.getLineByDelta(t)).map(t=>l.weightLine(t,c.ZERO,c.EMPTY)+l.weightLine(t,c.CROSS,c.EMPTY)).reduce((t,e)=>t+e);i.push({row:r.row,col:r.col,weight:n})}return i.sort((t,e)=>e.weight-t.weight)[0]}(t);t.makeStep(e.row,e.col,c.ZERO),d(t)}let f,g={dimension:10,countToWin:5};function m(){p(f=new c(g)),f.on("enlargeField",()=>p(f)),f.on("makeStep",(t,e,n)=>(function(t,e,n){_(n,t,e),function(t){const e=t.lastSteps[t.lastSteps.length-2];void 0!==e&&S(e.y,e.x).classList.remove("lastStep");const n=t.lastSteps[t.lastSteps.length-1];void 0!==n&&S(n.y,n.x).classList.add("lastStep")}(f);const i=f.status;null!==i&&(alert(i.symbol),function(t,e="#333"){for(let n of t)_(n.symbol,n.row,n.col,e)}(i.line,"#ff0000"))})(t,e,n))}function p(t){h.innerHTML="";let e=t.field;for(let n=0;n<e.height;n++){const i=document.createElement("tr");for(let r=0;r<e.width;r++){const e=document.createElement("td");e.textContent=t.getSymbolFromField(n,r),e.addEventListener("click",()=>y(n,r)),i.appendChild(e)}h.appendChild(i)}}function y(t,e){f.makeStep(t,e,f.currentPlayer),d(f)}function _(t,e,n,i="#333"){const r=S(e,n);r.textContent=t,r.style.color=i}function S(t,e){return h.querySelectorAll("tr")[t].querySelectorAll("td")[e]}function v(){m()}function b(){let t=+document.getElementById("fieldSize").value;g.dimension=t>3?t:3;let e=+document.getElementById("lineToWin").value;g.countToWin=e<3?3:e,m()}m(),document.getElementById("reset").addEventListener("click",v),document.getElementById("setSettings").addEventListener("click",b)}]);